<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Let's Play Together</title>
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              secondary: "#8ECAE6",
              accent: "#219EBC",
              dark: "#023047",
              warning: "#FFB703",
              primary: "#FB8500",
            },
          },
        },
      };
    </script>
    <style>
      html,
      body {
        overflow: hidden;
      }
    </style>
  </head>
  <body
    class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 to-gray-800 p-4"
  >
    <div
      class="w-full max-w-md border-2 border-purple-500 bg-gray-900 text-white rounded-lg shadow-xl -mt-20"
    >
      <!-- Card Header -->
      <div class="p-6 space-y-1 text-center">
        <div class="flex justify-center mb-2">
          <!-- Gamepad SVG Icon -->
          <?xml version="1.0" encoding="iso-8859-1"?>
          <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
          <svg
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            width="64"
            height="64"
            style="enable-background: new 0 0 512 512"
            xml:space="preserve"
          >
            <path
              style="fill: #314e55"
              d="M404.071,210.46c-0.58-0.116-1.17-0.174-1.786-0.174h-91.429v-27.429
            c0-5.049-4.089-9.143-9.143-9.143h-18.286v-28.911c0-1.379,0-6.281,0-7.661c0-10.085,8.205-18.286,18.286-18.286
            c1.703,0,7.44,0,9.143,0h100.571c0.316,0,1.464,0,1.78,0c20.17,0,36.571-16.406,36.571-36.571c0-5.049-4.089-9.143-9.143-9.143
            s-9.143,4.094-9.143,9.143c0,10.085-8.205,18.286-18.286,18.286c-0.316,0-1.464,0-1.78,0H310.857c-1.703,0-7.44,0-9.143,0
            c-20.17,0-36.571,16.406-36.571,36.571c0,1.379,0,6.281,0,7.661v28.911h-36.571c-5.053,0-9.143,4.094-9.143,9.143v27.429H109.714
            c-0.598,0-1.187,0.058-1.759,0.174C47.304,213.764,0,263.625,0,324.572c0,63.018,51.268,114.286,114.286,114.286
            c31.884,0,62.187-13.277,83.795-36.571H313.92c21.607,23.295,51.911,36.571,83.795,36.571c63.018,0,114.286-51.268,114.286-114.286
            C512,263.639,464.705,213.781,404.071,210.46z"
            />
            <g>
              <rect
                x="237.714"
                y="192"
                style="fill: #eaeaea"
                width="54.857"
                height="18.286"
              />
              <path
                style="fill: #eaeaea"
                d="M397.714,420.572c-27.982,0-54.509-12.17-72.777-33.393c-1.732-2.018-4.268-3.178-6.928-3.178
              H193.991c-2.661,0-5.196,1.161-6.928,3.178c-18.268,21.223-44.795,33.393-72.777,33.393c-52.938,0-96-43.067-96-96
              c0-51.58,40.33-93.71,91.821-95.911c0.312-0.013,0.634-0.045,0.938-0.089h117.527h73.143h99.232
              c0.312,0.045,0.625,0.076,0.947,0.089c51.491,2.201,91.821,44.33,91.821,95.911C493.714,377.505,450.652,420.572,397.714,420.572z"
              />
            </g>
            <g>
              <path
                style="fill: #314e55"
                d="M155.429,310.857h-36.571v-36.571c0-5.049-4.089-9.143-9.143-9.143
              c-5.053,0-9.143,4.094-9.143,9.143v36.571H64c-5.053,0-9.143,4.094-9.143,9.143c0,5.049,4.089,9.143,9.143,9.143h36.571v36.571
              c0,5.049,4.089,9.143,9.143,9.143c5.053,0,9.143-4.094,9.143-9.143v-36.571h36.571c5.053,0,9.143-4.094,9.143-9.143
              C164.571,314.951,160.482,310.857,155.429,310.857z"
              />
              <path
                style="fill: #314e55"
                d="M393.143,301.714c15.125,0,27.429-12.304,27.429-27.429s-12.304-27.429-27.429-27.429
              s-27.429,12.304-27.429,27.429S378.018,301.714,393.143,301.714z"
              />
            </g>
            <circle style="fill: #e65f58" cx="393.143" cy="274.286" r="9.143" />
            <path
              style="fill: #314e55"
              d="M448,292.572c-15.125,0-27.429,12.304-27.429,27.429c0,15.125,12.304,27.429,27.429,27.429
            c15.125,0,27.429-12.304,27.429-27.429C475.429,304.875,463.125,292.572,448,292.572z"
            />
            <circle style="fill: #e65f58" cx="448" cy="320" r="9.143" />
            <path
              style="fill: #314e55"
              d="M338.286,292.572c-15.125,0-27.429,12.304-27.429,27.429c0,15.125,12.304,27.429,27.429,27.429
            s27.429-12.304,27.429-27.429C365.714,304.875,353.411,292.572,338.286,292.572z"
            />
            <circle style="fill: #e65f58" cx="338.286" cy="320" r="9.143" />
            <path
              style="fill: #314e55"
              d="M393.143,338.286c-15.125,0-27.429,12.304-27.429,27.429s12.304,27.429,27.429,27.429
            s27.429-12.304,27.429-27.429S408.268,338.286,393.143,338.286z"
            />
            <circle style="fill: #e65f58" cx="393.143" cy="365.714" r="9.143" />
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
            <g></g>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-purple-400">Let's Play Together</h2>
        <p class="text-gray-400">Enter your nickname to connect and play.</p>
      </div>

      <!-- Card Content -->
      <div class="px-6 pb-4">
        <form id="loginForm">
          <div class="space-y-4">
            <div class="space-y-2">
              <input
                id="nickname"
                type="text"
                placeholder="Enter your nickname"
                class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"
                required
              />
            </div>
            <button
              type="submit"
              id="connectBtn"
              class="w-full py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-md transition-colors"
              disabled
            >
              Connect
            </button>
          </div>
        </form>
      </div>

      <!-- Card Footer -->
      <div
        class="flex flex-col items-center border-t border-gray-800 pt-4 pb-6 px-6"
      >
        <div class="flex space-x-2 items-center">
          <!-- Small Gamepad SVG Icon -->
          <svg
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            width="32"
            height="32"
            style="enable-background: new 0 0 512 512"
            xml:space="preserve"
          >
            <path
              style="fill: #314e55"
              d="M404.071,210.46c-0.58-0.116-1.17-0.174-1.786-0.174h-91.429v-27.429
            c0-5.049-4.089-9.143-9.143-9.143h-18.286v-28.911c0-1.379,0-6.281,0-7.661c0-10.085,8.205-18.286,18.286-18.286
            c1.703,0,7.44,0,9.143,0h100.571c0.316,0,1.464,0,1.78,0c20.17,0,36.571-16.406,36.571-36.571c0-5.049-4.089-9.143-9.143-9.143
            s-9.143,4.094-9.143,9.143c0,10.085-8.205,18.286-18.286,18.286c-0.316,0-1.464,0-1.78,0H310.857c-1.703,0-7.44,0-9.143,0
            c-20.17,0-36.571,16.406-36.571,36.571c0,1.379,0,6.281,0,7.661v28.911h-36.571c-5.053,0-9.143,4.094-9.143,9.143v27.429H109.714
            c-0.598,0-1.187,0.058-1.759,0.174C47.304,213.764,0,263.625,0,324.572c0,63.018,51.268,114.286,114.286,114.286
            c31.884,0,62.187-13.277,83.795-36.571H313.92c21.607,23.295,51.911,36.571,83.795,36.571c63.018,0,114.286-51.268,114.286-114.286
            C512,263.639,464.705,213.781,404.071,210.46z"
            />
            <g>
              <rect
                x="237.714"
                y="192"
                style="fill: #eaeaea"
                width="54.857"
                height="18.286"
              />
              <path
                style="fill: #eaeaea"
                d="M397.714,420.572c-27.982,0-54.509-12.17-72.777-33.393c-1.732-2.018-4.268-3.178-6.928-3.178
              H193.991c-2.661,0-5.196,1.161-6.928,3.178c-18.268,21.223-44.795,33.393-72.777,33.393c-52.938,0-96-43.067-96-96
              c0-51.58,40.33-93.71,91.821-95.911c0.312-0.013,0.634-0.045,0.938-0.089h117.527h73.143h99.232
              c0.312,0.045,0.625,0.076,0.947,0.089c51.491,2.201,91.821,44.33,91.821,95.911C493.714,377.505,450.652,420.572,397.714,420.572z"
              />
            </g>
            <g>
              <path
                style="fill: #314e55"
                d="M155.429,310.857h-36.571v-36.571c0-5.049-4.089-9.143-9.143-9.143
              c-5.053,0-9.143,4.094-9.143,9.143v36.571H64c-5.053,0-9.143,4.094-9.143,9.143c0,5.049,4.089,9.143,9.143,9.143h36.571v36.571
              c0,5.049,4.089,9.143,9.143,9.143c5.053,0,9.143-4.094,9.143-9.143v-36.571h36.571c5.053,0,9.143-4.094,9.143-9.143
              C164.571,314.951,160.482,310.857,155.429,310.857z"
              />
              <path
                style="fill: #314e55"
                d="M393.143,301.714c15.125,0,27.429-12.304,27.429-27.429s-12.304-27.429-27.429-27.429
              s-27.429,12.304-27.429,27.429S378.018,301.714,393.143,301.714z"
              />
            </g>
            <circle style="fill: #e65f58" cx="393.143" cy="274.286" r="9.143" />
            <path
              style="fill: #314e55"
              d="M448,292.572c-15.125,0-27.429,12.304-27.429,27.429c0,15.125,12.304,27.429,27.429,27.429
            c15.125,0,27.429-12.304,27.429-27.429C475.429,304.875,463.125,292.572,448,292.572z"
            />
            <circle style="fill: #e65f58" cx="448" cy="320" r="9.143" />
            <path
              style="fill: #314e55"
              d="M338.286,292.572c-15.125,0-27.429,12.304-27.429,27.429c0,15.125,12.304,27.429,27.429,27.429
            s27.429-12.304,27.429-27.429C365.714,304.875,353.411,292.572,338.286,292.572z"
            />
            <circle style="fill: #e65f58" cx="338.286" cy="320" r="9.143" />
            <path
              style="fill: #314e55"
              d="M393.143,338.286c-15.125,0-27.429,12.304-27.429,27.429s12.304,27.429,27.429,27.429
            s27.429-12.304,27.429-27.429S408.268,338.286,393.143,338.286z"
            />
            <circle style="fill: #e65f58" cx="393.143" cy="365.714" r="9.143" />
          </svg>
          <span class="text-sm text-gray-400">
            Local co-op gaming has never been easier
          </span>
        </div>
        <p
          class="mt-6 px-3 py-1 text-xs text-gray-200 bg-purple-700 rounded-md italic"
        >
          For the best gaming experience, connect a compatible joystick (Xbox,
          PlayStation, etc.).
        </p>
      </div>
    </div>

    <!-- Modal de espera -->
    <div
      id="waitingModal"
      class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 hidden"
    >
      <div
        class="bg-gray-900 border-2 border-purple-500 rounded-lg shadow-xl p-8 text-center"
      >
        <h2 class="text-2xl font-bold text-purple-400 mb-4">
          Waiting for confirmation
        </h2>
        <p class="text-gray-400">
          Please wait while the host approves your connection...
        </p>
      </div>
    </div>

    <!-- Modal de mensaje (reemplaza alert) -->
    <div
      id="messageModal"
      class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 hidden"
    >
      <div
        class="bg-gray-900 border-2 border-purple-500 rounded-lg shadow-xl p-8 text-center"
      >
        <h2
          id="messageTitle"
          class="text-2xl font-bold text-purple-400 mb-4"
        ></h2>
        <p id="messageContent" class="text-gray-400 mb-4"></p>
        <button
          id="messageCloseBtn"
          class="w-full bg-orange-500 hover:bg-orange-600 text-white rounded-md py-2 transition-colors"
        >
          OK
        </button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const nicknameInput = document.getElementById("nickname");
      const connectBtn = document.getElementById("connectBtn");
      const loginForm = document.getElementById("loginForm");

      nicknameInput.addEventListener("input", function () {
        connectBtn.disabled = !this.value.trim();
      });

      loginForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const nick = nicknameInput.value.trim();
        if (!nick) {
          showMessage("Error", "Please enter a nickname.");
          return;
        }
        waitingModal.classList.remove("hidden");
        socket.emit("peerRequest", { nick });
      });

      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log(
                "Service Worker registrado con scope:",
                registration.scope
              );
            })
            .catch((error) => {
              console.error("Error al registrar el Service Worker:", error);
            });
        });
      }

      window.addEventListener("load", () => {
        document.cookie =
          "approved=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
      });

      const socket = io();
      const waitingModal = document.getElementById("waitingModal");
      const messageModal = document.getElementById("messageModal");
      const messageTitle = document.getElementById("messageTitle");
      const messageContent = document.getElementById("messageContent");
      const messageCloseBtn = document.getElementById("messageCloseBtn");

      function showMessage(title, message) {
        messageTitle.textContent = title;
        messageContent.textContent = message;
        messageModal.classList.remove("hidden");
      }

      messageCloseBtn.addEventListener("click", () => {
        messageModal.classList.add("hidden");
      });

      socket.on("peerApproval", (data) => {
        waitingModal.classList.add("hidden");
        if (data.approved) {
          localStorage.setItem("userNick", nicknameInput.value.trim());
          // Se establece la cookie aprobada y se redirige a watch.html
          document.cookie = "approved=1; path=/";
          window.location.href = "/watch.html";
        } else {
          showMessage("Rejected", "Request denied by the host.");
        }
      });
    </script>
  </body>
</html>
